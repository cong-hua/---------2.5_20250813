# 小红书笔记发布助手

一个帮助批量发布小红书笔记的 Chrome/Edge 扩展。

## 功能特点

- 支持批量发布多篇笔记
- 支持多图片上传和排序
- 智能识别标题、正文和标签
- 支持添加商品链接
- 自定义发布时间间隔
- 实时显示发布状态和倒计时
- 自动保存发布进度
- 支持断点续传
- **新增：** 支持从飞书多维表格导入数据
- **新增：** 图片自动按文件名中的数字排序

## 使用说明

### 文案格式要求

文案文件需要按以下格式编写：

```
标题
正文内容（支持多行和空行）
...

#标签1 #标签2 #标签3
商品ID: xxxxx

-----（使用5个及以上的横线作为分隔符）

下一篇笔记
...
```

### 操作步骤

1. 点击"选择文案文件"导入笔记内容
2. 为每篇笔记添加图片（支持拖拽排序）
   - **新功能**: 图片会自动按文件名中的数字排序
   - 为了充分利用这个功能，可以将图片命名为"1.jpg"、"2.jpg"等或者包含数字的名称
   - 排序根据文件名中的第一个数字进行，例如"封面1.jpg"会排在"内容2.jpg"前面
3. 设置发布间隔（固定或随机）
4. 点击"开始发布"按钮
5. 实时查看发布进度和状态

### 从飞书导入（新功能）

1. 点击"从飞书导入"按钮
2. 在弹出的配置框中填写飞书多维表格的相关信息：
   - 应用ID (App ID)
   - 应用密钥 (App Secret)
   - 应用令牌 (App Token)
   - 表格ID (Table ID)
   - 视图ID (View ID，可选)
3. 点击"测试连接"确认配置正确
4. 点击"保存配置"保存设置
5. 再次点击"从飞书导入"开始导入数据

#### 飞书导入的图片排序规则
- 从飞书导入的图片会自动按照文件名中的数字排序
- 排序规则与本地上传一致，提取文件名中的第一个数字并按升序排列
- 如果飞书中的图片命名为"1.jpg"、"2.jpg"等有序名称，导入后会保持相同顺序
- 对于没有数字的文件名，会排在所有有数字的文件之后

### 注意事项

- 确保已登录小红书创作者平台
- 建议每篇笔记的发布间隔不要太短
- 发布过程中可以实时查看状态
- 支持暂停和继续发布
- 自动保存发布进度，意外关闭后可继续

## 更新日志

### v2.4.0
- 新增图片按文件名数字自动排序功能
- 优化图片上传体验，现在会显示图片文件名
- 增强图片管理能力，更直观地了解图片顺序
- 从飞书导入的图片也会按文件名数字自动排序
- 支持显示飞书图片的原始文件名

### v2.3.0
- 修复测试飞书连接时自动下载文件的问题
- 优化飞书API调用逻辑，降低不必要的网络请求
- 改进内存使用和缓存机制

### v2.2.0
- 新增从飞书多维表格导入数据的功能
- 修复从飞书导入图片无法上传到小红书的问题
- 优化图片处理逻辑，支持多种图片格式和来源
- 改进错误处理和日志记录

### v2.1.0
- 优化发布状态显示
- 添加实时倒计时功能
- 改进图片拖拽排序
- 优化日志显示效果

### v2.0.0
- 重构代码架构
- 添加断点续传功能
- 优化图片处理逻辑
- 改进错误处理机制

### v1.0.0
- 首次发布

## 飞书集成

### 支持的数据格式
从飞书多维表格导入时，支持以下字段映射：
- 标题：表格中的标题字段
- 正文：表格中的正文/内容字段
- 标签：表格中的标签字段（支持文本或多选）
- 商品ID：表格中的商品ID字段
- 图片：表格中的图片/附件字段（支持URL或飞书附件）

### 配置说明
需要在飞书开放平台创建自建应用，并获取以下信息：
- 应用ID
- 应用密钥
- 多维表格应用令牌
- 表格ID
- 视图ID（可选）

### 已解决的问题
- ✅ 从飞书导入的图片无法上传到小红书：已修复，通过将Blob转换为base64格式解决
- ✅ 图片索引问题：已优化，确保索引一致性
- ✅ 测试飞书连接时自动下载文件问题：已修复，增加测试模式避免不必要的文件下载

### 飞书测试连接修复
在v2.3.0版本中，我们修复了以下问题：
- 点击"测试连接"按钮时浏览器会自动下载临时文件（如1745123809698_download）
- 修复原理：添加测试模式（testMode）跳过所有非必要的下载操作
- 技术细节：
  - 在飞书客户端中增加测试模式参数
  - 修改下载相关函数，在测试模式下避免实际下载
  - 优化图片处理逻辑，避免额外的网络请求
  - 使用内存缓存代替文件下载

## 界面布局

- 紧凑型设计，总宽度400px
- 左侧笔记预览区域(270px)
  - 笔记标题和删除按钮
  - 图片上传和预览
  - 笔记内容编辑区域
- 右侧操作日志区域(130px)
  - 实时显示操作状态
  - 发布倒计时显示
- 底部设置和控制区域
  - 发布间隔设置
  - 开始运行按钮
  - 飞书导入按钮

## 注意事项

1. 使用前请确保：
   - 已登录小红书创作者中心
   - 网络连接稳定
   - 浏览器窗口保持打开

2. 发布建议：
   - 合理设置发布间隔（建议不少于5分钟）
   - 避免频繁发布
   - 图片数量建议4-9张
   - 标签数量建议3-10个

3. 浏览器支持：
   - 支持 Chrome 浏览器
   - 支持 Microsoft Edge 浏览器
   - 其他基于 Chromium 的浏览器可能也支持

4. 其他说明：
   - 支持实时查看发布状态
   - 关闭插件窗口不影响发布
   - 重新打开可恢复之前状态
   - 发布完成后自动停止

## 技术支持

如有问题或建议，请提交 Issue。

## 免责声明

本扩展仅供学习交流使用，请遵守相关平台规则，对于违规使用导致的任何问题，本扩展概不负责。

## 项目背景
在小红书发布文章时，经常需要手动复制粘贴内容、添加标签、上传图片等重复性操作。这个浏览器扩展可以帮你：
- 一键导入文章内容（支持标题、正文、标签的智能识别）
- 批量选择上传图片（支持多选和预览）
- 模拟人工输入（自然的输入速度和间隔）
- 智能处理标签（自动等待并选择推荐关键词）
- 自动添加商品（支持商品ID直接关联）
- 提供操作日志（实时反馈每个步骤的状态）
- 从飞书多维表格导入数据（支持批量导入多篇笔记）

## 项目结构
```
xiaohongshu-helper/
├── manifest.json (Chrome扩展配置)
├── popup.html (助手界面)
├── popup.js (核心功能代码)
├── feishu_client.js (飞书API客户端)
├── background.js (后台脚本)
├── content.js (内容脚本)
├── README.md (使用说明)
└── images/ (图标等资源)
```

## 技术说明
- 使用原生JavaScript开发，无需额外依赖
- 采用Chrome扩展开发规范
- 模拟真实的人工输入事件
- 完整的错误处理机制
- 详细的操作日志记录
- 飞书API集成，支持多维表格数据导入

## 开发者功能

### 测试按钮
本插件包含用于开发和调试的测试功能，默认隐藏：

#### 启用测试按钮
1. 打开 `popup.js` 文件
2. 找到以下代码（大约在更新笔记面板的函数中）：
   ```javascript
   // 测试按钮临时隐藏，需要时可以将下面的 false 改为 true 来显示测试按钮
   const showTestButtons = false;
   ```
3. 将 `false` 改为 `true` 保存文件
4. 重新加载插件即可显示测试按钮

#### 测试按钮功能
- **测试更新飞书字段**：直接测试更新飞书记录的"是否发布"字段为`true`
- **检查飞书配置**：验证飞书配置是否正确完整

#### 隐藏测试按钮
1. 将上述代码中的 `true` 改回 `false`
2. 保存文件并重新加载插件

#### 适用场景
- 排查飞书更新字段失败的问题
- 检查飞书API配置是否正确
- 验证飞书登录状态
- 调试发布后更新飞书状态的功能

## 当前项目状态

### 已完成功能
- 基本的笔记发布流程
- 图片上传和预览
- 标签和商品ID处理
- 从飞书多维表格导入数据
- 本地文件导入

### 已知问题及解决方案
- ✅ 从飞书导入的图片无法上传到小红书：已修复，通过将Blob转换为base64格式解决
- ✅ 图片索引问题：已优化，确保索引一致性
- ✅ 测试飞书连接时自动下载文件问题：已修复，增加测试模式避免不必要的文件下载
- ✅ 图片排序困难：已增加按文件名数字自动排序功能，更方便地控制图片顺序

### 正在进行的工作
- 改进图片处理流程
- 优化飞书数据导入体验
- 提高发布稳定性

## 开发计划
- [x] 支持从飞书多维表格导入
- [ ] 支持更多文本格式（如Markdown）
- [ ] 添加文章模板功能
- [x] 支持批量处理多篇文章
- [ ] 添加自定义输入速度
- [ ] 支持更多浏览器

## 贡献指南
欢迎提交Issue和Pull Request，一起改进这个工具。

## 许可证
MIT License

## 联系方式
如有问题或建议，欢迎通过以下方式联系：
- 提交Issue
- 发送邮件到：[your-email@example.com]
